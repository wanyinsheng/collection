## 为什么 TCP 连接需要三次握手，两次不可以么，为什么？
### TCP三次握手的必要性

#### 1. 确认双方的接收与发送能力
##### 1.1 两次握手不足
如果只有两次握手，即客户端发送一个同步请求（SYN）到服务器，服务器回复一个确认（ACK），这样只能确认服务器接收和发送的能力，但不能确认客户端的接收能力。

##### 1.2 三次握手的过程
1. 客户端发送一个同步请求（SYN）到服务器，表明客户端希望建立连接。
2. 服务器回复一个同步-确认消息（SYN-ACK），确认收到客户端的请求，并且告诉客户端它的接收和发送能力是正常的。
3. 客户端再次发送确认消息（ACK）给服务器，确认它已经收到服务器的同步-确认消息，这样客户端的接收能力也得到了验证。

#### 2. 防止失效的连接请求建立连接
##### 2.1 旧的连接请求
网络中可能存在延迟长时间才到达服务器的旧的连接请求。如果只有两次握手，那么服务器收到这样一个请求后，会误以为是新的连接请求，就会建立连接，并等待客户端发送数据，造成资源浪费。

##### 2.2 三次握手解决方案
三次握手通过最后一次客户端发送的确认（ACK），可以忽略掉旧的连接请求。只有当客户端再次确认后，服务器才会认为连接是当前有效的，并开始数据传输。如果是一个旧的同步请求，客户端不会对服务器的同步-确认消息（SYN-ACK）进行响应，因此服务器不会建立连接。

#### 3. 同步序列号
##### 3.1 序列号的重要性
TCP连接中的序列号用于保证数据包的顺序和完整性。在三次握手过程中，双方都会通告自己的初始序列号，确保数据传输的一致性和可靠性。

##### 3.2 两次握手的问题
如果只进行两次握手，那么只有服务器的序列号被确认，客户端的序列号没有得到服务器的确认，这可能导致数据传输中的问题。

#### 4. 结论
三次握手是确保TCP连接的可靠性的最小握手次数。它可以验证双方的接收和发送能力，防止失效的连接请求造成资源浪费，并且同步双方的序列号以保证数据传输的一致性和可靠性。两次握手无法满足这些需求，因此不足以建立一个稳定可靠的TCP连接。

## 什么是 TCP 四次挥手

### TCP四次挥手的过程及其必要性

#### 1. TCP四次挥手的过程
##### 1.1 第一次挥手（FIN from Client）
客户端发送一个结束请求（FIN）到服务器，表示客户端已经没有数据要发送了，但是仍然可以接收数据。

##### 1.2 第二次挥手（ACK from Server）
服务器收到这个结束请求后，发送一个确认消息（ACK）给客户端，表示已经收到客户端的结束请求，但服务器可能还有数据需要发送给客户端。

##### 1.3 第三次挥手（FIN from Server）
服务器发送完所有的数据后，它会发送一个结束请求（FIN）给客户端，告诉客户端所有的数据都发送完毕了。

##### 1.4 第四次挥手（ACK from Client）
客户端收到服务器的结束请求后，发送一个确认消息（ACK）给服务器，然后等待足够长的时间（通常是2倍的最大报文生存时间MSL）以确保服务器接收到这个确认消息，之后关闭连接。这个等待时间也确保了客户端能够重新发送确认消息，如果服务器没有收到确认。

#### 2. 四次挥手的必要性
##### 2.1 半关闭状态
TCP提供的是全双工服务，即数据可以在两个方向上独立地传输。当一方完成它的数据发送任务后，它需要发送FIN来终止这个方向上的连接。接收到FIN的一方仍然可以发送数据，直到也发送FIN。

##### 2.2 确保数据完整传输
通过四次挥手，TCP确保了双方数据都能够完整地发送和接收。即使一方完成了发送任务，也需要等待另一方也确认发送完毕。

##### 2.3 防止资源浪费
如果没有足够的挥手次数，可能会导致“TIME_WAIT”状态下的端口或资源不能及时释放，或者新的连接中可能出现旧连接的数据包，造成数据混淆。

#### 3. 结论
TCP的四次挥手是结束一个TCP连接所必需的步骤，它确保了数据能够完整地传输，并且连接被适当地关闭。这个过程解决了TCP连接的全双工特性，确保了双方都能够完成数据发送和接收，且资源得到正确释放，避免了可能出现的连接混淆问题。
